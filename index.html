<!DOCTYPE html>
<html>

<head>
    <title>Ethnic Filter</title>
    <link href="https://fonts.googleapis.com/css?family=Archivo+Black|Kanit:800,900|Khula:800|Paytone+One|Rubik+Mono+One|Work+Sans:900" rel="stylesheet">
    <style>
    html,
    body {
        width: 100%;
        height: 100%;
        margin: 0px;
        font-family: 'Archivo Black', sans-serif;
        font-size: 1em;
        color: white;
        cursor: pointer;
    }
    
    video {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    video.white {
        filter: blur(0px);
        transition: 1s;
    }
    
    video.hispanic {
        filter: blur(10px);
        transition: 1s;
    }
    
    video.asian {
        filter: blur(12px);
        transition: 1s;
    }
    
    video.black {
        filter: blur(35px);
        transition: 1s;
    }
    
    a {
        color: white;
    }
    
    #text {
        opacity: .75;
        font-size: 6em;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -o-user-select: none;
        user-select: none;
        pointer-events: none;
    }

    #about p {
        color: white;
        font-size: 1.5em;
    }

    .overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.85);
        background: url(data:;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAABl0RVh0U29mdHdhcmUAUGFpbnQuTkVUIHYzLjUuNUmK/OAAAAATSURBVBhXY2RgYNgHxGAAYuwDAA78AjwwRoQYAAAAAElFTkSuQmCC) repeat scroll transparent\9;
        /* ie fallback png background image */
        z-index: 9999;
        display: none;
    }
    
    .center {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translateX(-50%) translateY(-50%);
    }
    
    .top-right {
        position: absolute;
        top: 2%;
        right: 1%;
    }
    
    .round-button {
        display: block;
        width: 1.25em;
        height: 1.25em;
        line-height: 1.25em;
        border-radius: 50%;
        color: #000;
        text-align: center;
        background: #fff;
        font-size: 1.25em;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -o-user-select: none;
        user-select: none;
    }
    
    .round-button:hover {
        color: rgba(0, 0, 0, 0.5);
    }
    </style>
</head>

<body>
    <!-- <canvas id="canvas" width="640" height="480"></canvas> -->
    <video class="" autoplay></video>
    <div id="text" class="center">WHITE</div>
    <a id="about-btn" class="top-right round-button">?</a></div>
    <div id="about" class="overlay">
        <div class="center">
            <p>A data visualization/webcam filter of ethnicity based on the <a href="http://www.designcensus.com">Design Census</a>. There were <a href="https://github.com/AIGAGitHub/DesignCensus2016">7205 Whites, 998 Hispanics, 951 Asians and 349 Blacks</a>. White was set to 0 while the others were mapped to a range from 10-35 using linear scaling. Pro tip: squint your eyes for equality. Commissioned by AIGA for Design Census Gallery. Made with <3 in NYC. Adobe CS plugins coming soon... </p>
        </div>
        <a id="close-btn" class="top-right round-button">X</a>
    </div>
    <script>
    (function() {
        var data = [{
            key: "White",
            value: 7205
        }, {
            key: "Hispanic",
            value: 998
        }, {
            key: "Asian",
            value: 951
        }, {
            key: "Black",
            value: 349
        }]

        var valueRange = [349, 998];
        var blurRange = [35, 5] //[.35, .05] 

        var index = 0;

        var text = document.getElementById('text');

        function hasGetUserMedia() {
            return !!(navigator.getUserMedia || navigator.webkitGetUserMedia ||
                navigator.mozGetUserMedia || navigator.msGetUserMedia);
        }

        if (hasGetUserMedia()) {
            // Good to go!
        } else {
            alert('getUserMedia() is not supported in your browser');
        }

        var errorCallback = function(e) {
            console.log('Reeeejected!', e);
        };

        navigator.getUserMedia = navigator.getUserMedia ||
            navigator.webkitGetUserMedia ||
            navigator.mozGetUserMedia ||
            navigator.msGetUserMedia;

        var video = document.querySelector('video');

        if (navigator.getUserMedia) {
            navigator.getUserMedia({
                video: true
            }, function(stream) {
                video.src = window.URL.createObjectURL(stream);
            }, errorCallback);
        } else {
            // fallback
        }

        video.addEventListener('click', update);

        // var canvas = document.getElementById('canvas');
        // canvas.width = window.innerWidth;
        // canvas.height = window.innerHeight;

        // document.getElementById("save-btn").addEventListener("click", function() {
        // var context=canvas.getContext("2d");
        // context.drawImage(video, 0, 0) 
        // });

        document.getElementById("about-btn").addEventListener("click", function() {
            document.getElementById("about").style.display = "block"
        });

        document.getElementById("close-btn").addEventListener("click", function() {
            document.getElementById("about").style.display = "none"
        });

        function update() {
            index = (++index) % data.length;

            video.className = data[index].key.toLowerCase()
            text.innerHTML = data[index].key.toUpperCase();
        }
    }());
    </script>
</body>

</html>
